services:
  engine:
    build:
      context: ./python-engine
    env_file:
      - ./python-engine/.env
    environment:
      ENGINE_PORT: ${ENGINE_PORT:-5000}
      ENGINE_REQUEST_TIMEOUT: ${ENGINE_REQUEST_TIMEOUT:-180}
    ports:
      - "5000:5000"

  server:
    build:
      context: ./server
    environment:
      PORT: 3001
      ENGINE_URL: http://engine:5000/analyze
      CORS_ORIGIN: http://localhost:4173
      WCE_SHARED_KEY: ${WCE_SHARED_KEY:-super-secret-key}
      ENGINE_TIMEOUT_MS: ${ENGINE_TIMEOUT_MS:-180000}
    depends_on:
      - engine
    ports:
      - "3001:3001"

  wcs:
    build:
      context: ./wcs
      args:
        VITE_API_URL: /avalie
        VITE_WCE_KEY: ${WCE_SHARED_KEY:-super-secret-key}
    depends_on:
      - server
    ports:
      - "4173:80"
