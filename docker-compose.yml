version: "3.9"

services:
  engine:
    build:
      context: ./python-engine
    environment:
      ENGINE_PORT: 5000
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      OPENAI_MODEL: ${OPENAI_MODEL:-gpt-4o-mini}
      OPENAI_BASE_URL: ${OPENAI_BASE_URL:-}
      OPENAI_AUTH_HEADER: ${OPENAI_AUTH_HEADER:-Authorization}
      OPENAI_AUTH_PREFIX: ${OPENAI_AUTH_PREFIX:-Bearer}
      ENABLE_CRAWLER: ${ENABLE_CRAWLER:-0}
      CRAWL_MAX_PAGES: ${CRAWL_MAX_PAGES:-5}
      CRAWL_MAX_TASKS: ${CRAWL_MAX_TASKS:-5}
      CRAWL_DELAY: ${CRAWL_DELAY:-0.3}
      CRAWL_TIMEOUT: ${CRAWL_TIMEOUT:-10}
    ports:
      - "5000:5000"

  server:
    build:
      context: ./server
    environment:
      PORT: 3001
      ENGINE_URL: http://engine:5000/analyze
      CORS_ORIGIN: http://localhost:4173
      WCE_SHARED_KEY: ${WCE_SHARED_KEY:-super-secret-key}
      ENGINE_TIMEOUT_MS: ${ENGINE_TIMEOUT_MS:-20000}
    depends_on:
      - engine
    ports:
      - "3001:3001"

  wcs:
    build:
      context: ./wcs
      args:
        VITE_API_URL: /avalie
        VITE_WCE_KEY: ${WCE_SHARED_KEY:-super-secret-key}
    depends_on:
      - server
    ports:
      - "4173:80"
